<h1>Profil</h1>

<% if current_user.photo.attached? %>
  <%= cl_image_tag current_user.photo.key, height: 300, width: 400, crop: :fill %>
<% else %>
  <img src="">
<% end %>
<p><%= current_user.biography %></p>
<%= link_to "Edit my profile", edit_user_registration_path %>

<br>
<div>
  <% if current_user.clubs.count != 0 %>
    <h2>Mes clubs</h2>

      <div class="overflowx pt-3 pb-3">
      <% @clubs.each do |club| %>
        <%= link_to club_path(club) do%>
          <div class="card-club shadow ms-3 me-3">
            <% if club.photo.attached? %>
              <%= cl_image_tag(club.photo.key, height: 200, width: 380, crop: :fill) %>
            <% else %>
              <div class="sans-photo"><%= club.name %></div>
            <% end %>

            <div class="d-flex flex-row justify-content-between align-items-center mt-2">
              <h2><%= club.name %></h2>
              <h3><%= club.category %></h3>
            </div>

            <div class="d-flex flew-row align-items-center justify-content-between mt-1">
              <div class="d-flex flex-row align-items-center">
                <p class="me-2"><strong><%= club.capacity %></strong></p>
                <i class="fa-solid fa-people-group"></i>
              </div>
              <div class="d-flex flex-row align-items-center">
                <p><strong><%= club.hour_price.round %>€</strong></p>
              </div>
            </div>

            <div class="d-flex flew-row align-items-center w-100 text-truncate mt-2">
              <i class="fa-solid fa-location-dot"></i>
              <p class="ms-2"><%= club.address %></p>
            </div>

            <div class="d-flex flew-row align-items-center justify-content-start">
              <div class="d-flex flex-row align-items-center">
                <i class="fa-solid fa-phone"></i>
                <p class="ms-2 me-4"><%= club.phone_number %></p>
              </div>
              <div class="d-flex flex-row align-items-center">
                <i class="fa-solid fa-envelope"></i>
                <p class="ms-2"><%= club.user.email %></p>
              </div>
            </div>

          </div>
        <% end %>
      <% end %>
  <% end %>
</div>
<br>

<div>
  <% if current_user.bookings.count != 0 %>
    <h2>Mes bookings</h2>
    <% @bookings.each do |booking| %>
      <h3><%= booking.club.name %></h3>
      <p>Début de la réservation : <%= booking.start_date %></p>
      <p>Fin de la réservation : <%= booking.end_date %></p>
      <p>Statut de la réservation : <%= booking.accepted %></p>
      <%= link_to "Delete", bookings_delete_path(booking), data: {turbo_method: :delete, turbo_confirm: "Are you sure?"} %>
    <% end %>
  <% end %>
</div>

<div>
  <% if current_user.clubs.count != 0 %>
    <h2>Les bookings de mes clubs</h2>
    <% current_user.clubs.each do |club| %>
      <% club.bookings.each do |booking| %>
      <h3><%= booking.club.name %></h3>
      <%= link_to "#{booking.user.first_name} #{booking.user.last_name}", user_path(booking.user) %>
      <% if booking.user.photo.attached? %>
        <%= cl_image_tag(booking.user.photo.key, height: 300, width: 400, crop: :fill) %>
      <% else %>
        <img src="">
      <% end %>
      <p>Début de la réservation : <%= booking.start_date %></p>
      <p>Fin de la réservation : <%= booking.end_date %></p>
      <p>Statut de la réservation : <%= booking.accepted %></p>
      <%= link_to "Delete", bookings_delete_path(booking), data: {turbo_method: :delete, turbo_confirm: "Are you sure?"} %>
      <%= link_to "Accept this booking", booking_accepted_path(booking) %>
      <% end %>
    <% end %>
  <% end %>
</div>
